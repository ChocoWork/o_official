# 要件定義書生成プロンプト（テンプレート参照）

目的:
- リポジトリ内の仕様（`docs/ECSiteSpec.md` や既存の `docs/specs/`）を読み、機能群ごとにチケット化可能な要件定義書を生成する。

使用テンプレート:
- このプロンプトは以下のテンプレートファイルを必ず参照して出力してください:
- `.github/prompts/templates/requirement_template.md`

入力（必須）:
- `repo_root` (文字列): リポジトリルートのパス（例: `/workspace`）
- `base_spec` (文字列): ベース仕様ファイルパス（デフォルト: `docs/ECSiteSpec.md`）
- `targets` (配列): 生成対象の機能群リスト。例:
	- `["auth", "items", "cart", "checkout"]`
	- デフォルト: `["auth", "items", "cart", "checkout", "admin"]`
- `overwrite` (真偽値, optional): 既存ファイルを上書きするか。デフォルト `false`。上書きを許可する場合は明示的に `true` を指定すること。

出力要件:
- `docs/specs/` 以下にファイルを生成する
- 既存ファイルがある場合の扱い:
	- `overwrite=false` の場合: 既存ファイルを上書きしない。番号衝突がある場合は次の空き番号を自動選択してファイル名を決定する。
	- `overwrite=true` の場合: 上書きする前に生成結果の差分を提示し、明示的な確認（ユーザ入力）を要求すること。
- 各出力ファイルはテンプレートの各セクションを満たすこと。テンプレートに記載のない追加情報は、仕様から明確に導ける場合のみ補完すること。
- 各ファイル先頭に「基づく仕様ファイル: docs/ECSiteSpec.md」と推奨タスクID（例: `[DOC-01]`）を挿入する。

出力フォーマット（例）:
---
# 01_auth.md

基づく仕様ファイル: docs/ECSiteSpec.md
推奨タスクID: [DOC-01]

## 概要
（テンプレートに従って埋める）

## 機能要件
- ...

## 実装ノート
- ...
---

生成時の注意点:
- 破壊的変更が必要な場合は、理由・回避案・マイグレーション手順を必ず記載する。
- セキュリティ要件（環境変数名、Webhook の署名検証、RLS方針等）を漏れなく記載する。
- 型安全（Zod 等）や推奨実装スタックを言及する。
- 生成後は人がレビューし、必要に応じて分割・統合を行うこと。

実行手順（LLM に渡すときの指示）:
1. このプロンプトとテンプレート `.github/prompts/templates/requirement_template.md` を LLM に渡す。
2. `targets` と `overwrite` の値を指定する。
3. 出力された各ファイルを `docs/specs/` に保存し、チームでレビューする。

補足（運用上の安全策）:
- 生成プロセスはデフォルトで安全モード（`overwrite=false`）として動作する。既存の仕様が失われるリスクを避けるためです。
- 番号割当はソート順を壊さない連番方式を採用し、既存の `01_*` を検出した場合は自動で次の空き番号へ割り当てます。
- 大量生成やCI実行時は、事前に出力先のスナップショット（ファイル一覧）を取ることを推奨します。

---
End of prompt

